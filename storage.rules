rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper function to check if the user belongs to the organization
    function isMember(orgId) {
      return request.auth != null && request.auth.token.orgId == orgId;
    }

    // Secure PDF files based on the organization ID in the path
    // Path example: /invoices/{orgId}/{yyyy}/{mm}/{sha256}.pdf
    match /invoices/{orgId}/{yyyy}/{mm}/{file} {
      allow read, write: if isMember(orgId);
    }
  }
}
