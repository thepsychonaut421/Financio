
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Helper function to check if the user belongs to the organization
    function isMember(orgId) {
      return request.auth != null && request.auth.token.orgId == orgId;
    }

    // Rule for invoice files, structured by org, year, and month.
    // gs://.../invoices/{orgId}/{yyyy}/{mm}/{file}
    match /invoices/{orgId}/{yyyy}/{mm}/{file} {
      // Only authenticated members of the organization can read or write files.
      allow read, write: if isMember(orgId);
    }
  }
}
