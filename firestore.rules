rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if the user belongs to the organization
    function isMember(orgId) {
      return request.auth != null && request.auth.token.orgId == orgId;
    }

    // Secure the invoices subcollection under each organization
    match /orgs/{orgId}/invoices/{invoiceId} {
      allow read, write: if isMember(orgId);
    }
  }
}
